{% extends "base.html" %}

{% block content %}
<style>
  #adminTabs .nav-link { background: #ffffff; color: #495057; }
  #tab-manage.active, #tab-create.active, #tab-edit.active {
    background: #0d6efd; color: #fff;
  }
</style>

<div class="container py-4">
  <div class="row">
    <div class="col">
      <h1 class="h3 mb-1">Orgadmin Dashboard</h1>
      <p class="text-muted">Welcome, {{ current_user.name }}!</p>
    </div>
  </div>

  <!-- Nav Tabs -->
  <ul class="nav nav-pills mb-4 mt-1" id="adminTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-manage" data-bs-toggle="pill" data-bs-target="#pane-manage" type="button" role="tab">
        <i class="bi bi-people me-1"></i>User List
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-create" data-bs-toggle="pill" data-bs-target="#pane-create" type="button" role="tab">
        <i class="bi bi-person-plus me-1"></i>Employee Schedule
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-edit" data-bs-toggle="pill" data-bs-target="#pane-edit" type="button" role="tab">
        <i class="bi bi-pencil-square"></i>Overview of hours worked
      </button>
    </li>
  </ul>

  <div class="tab-content" id="adminTabsContent">

    <!-- User List Tab -->
    <div class="tab-pane fade show active" id="pane-manage" role="tabpanel">
      <div class="card shadow-sm p-4">
        <table class="table table-striped mb-0">
          <thead>
            <tr>
              <th>Name</th><th>Lastname</th><th>Email</th><th>Hours</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
              <tr>
                <td>{{ u.name }}</td>
                <td>{{ u.lastname }}</td>
                <td>{{ u.email }}</td>
                <td>TEST</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Overview Tab -->
    <div class="tab-pane fade" id="pane-edit" role="tabpanel">
      <div class="card shadow-sm p-4 mb-4">

        <!-- User Selection -->
        <div class="row g-3 mb-3">
          <div class="col-md-4">
            <label for="userSelectOverview" class="form-label">Select User:</label>
            <select id="userSelectOverview" class="form-select">
              <option value="">- Select User -</option>
              <option value="all">All Users</option>
              {% for u in users %}
                <option value="{{ u.id }}">{{ u.name }} {{ u.lastname }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- Date Picker Section (Always Shown) -->
        <div class="row g-3 mb-3">
          <div class="col-md-4">
            <label for="dateFrom" class="form-label">From:</label>
            <input type="date" id="dateFrom" class="form-control">
          </div>
          <div class="col-md-4">
            <label for="dateTo" class="form-label">To:</label>
            <input type="date" id="dateTo" class="form-control">
          </div>
          <div class="col-md-4 d-flex align-items-end">
            <button id="searchRange" class="btn btn-primary w-100">Filter Hours</button>
          </div>
        </div>

        <!-- Result Summary -->
        <div id="currentMonthResult" class="fw-bold mt-3"></div>

        <!-- Table of Work Records -->
        <div class="table-responsive mt-3">
          <table class="table table-striped-columns" id="workRecordsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Hours Worked</th>
                <th>Overtime hours</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

      </div>
    </div>

    <!-- Schedule Tab -->
    <div class="tab-pane fade" id="pane-create" role="tabpanel">
      <div class="card shadow-sm p-4">Schedule content goes here.</div>
    </div>

  </div>
</div>

<!-- JavaScript -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const workData = [
      { userId: 1, name: 'oscar', lastname: 'lugter', date: '2025-05-01', hours: 8 },
      { userId: 1, name: 'Bent', lastname: 'Over', date: '2025-05-10', hours: 6 },
      { userId: 1, name: 'Deez', lastname: 'Nuts', date: '2025-05-21', hours: 4 },
      { userId: 2, name: 'Imap', lastname: 'Ussay', date: '2025-05-05', hours: 7 },
      { userId: 2, name: 'Grab', lastname: 'Cock', date: '2025-05-20', hours: 5 },
      { userId: 3, name: 'gylpe', lastname: 'Gylp', date: '2025-04-18', hours: 9 }
    ];

    const userSelect = document.getElementById('userSelectOverview');
    const dateFrom = document.getElementById('dateFrom');
    const dateTo = document.getElementById('dateTo');
    const searchBtn = document.getElementById('searchRange');
    const resultBox = document.getElementById('currentMonthResult');
    const tableBody = document.querySelector('#workRecordsTable tbody');

    function isValidDate(d) {
      return d instanceof Date && !isNaN(d);
    }

    searchBtn.addEventListener('click', () => {
      const selectedValue = userSelect.value;
      const from = new Date(dateFrom.value);
      const to = new Date(dateTo.value);
      resultBox.textContent = '';
      tableBody.innerHTML = '';

      if (!selectedValue || !isValidDate(from) || !isValidDate(to)) {
        resultBox.textContent = "Please select a user and valid date range.";
        return;
      }

      let results = [];
      if (selectedValue === 'all') {
        results = workData.filter(entry => {
          const entryDate = new Date(entry.date);
          return entryDate >= from && entryDate <= to;
        });
      } else {
        const userId = parseInt(selectedValue);
        results = workData.filter(entry => {
          const entryDate = new Date(entry.date);
          return entry.userId === userId && entryDate >= from && entryDate <= to;
        });
      }

      if (results.length > 0) {
        let total = 0;
        results.forEach(entry => {
          total += entry.hours;
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${entry.name} ${entry.lastname}</td>
            <td>${entry.date}</td>
            <td>${entry.hours}</td>
          `;
          tableBody.appendChild(row);
        });
        resultBox.textContent = `Total hours from ${dateFrom.value} to ${dateTo.value}: ${total} hours`;
      } else {
        resultBox.textContent = "No records found in selected range.";
      }
    });
  });
</script>
{% endblock %}
