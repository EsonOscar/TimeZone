{% extends "base.html" %}

{% block content %}

<style>
  #adminTabs .nav-link { background: #ffffff; color: #495057; }
  #tab-manage.active, #tab-create.active, #tab-edit.active, #tab-delete.active {
    background: #0d6efd; color: #fff;
  }
</style>

<div class="container py-4">
  <div class="row">
    <div class="col">
      <h1 class="h3 mb-1">Org Control Panel</h1>
      <p class="text-muted">Welcome, {{ current_user.name }}!</p>
    </div>
    <div class="col">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, msg in messages %}
          <div class="mt-1 alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endwith %}
    </div>
  </div>

  <!-- Nav Pills -->
  <ul class="nav nav-pills mb-4 mt-1" id="adminTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-manage" data-bs-toggle="pill" data-bs-target="#pane-manage" type="button" role="tab">
        <i class="bi bi-people me-1"></i>User List
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-create" data-bs-toggle="pill" data-bs-target="#pane-create" type="button" role="tab">
        <i class="bi bi-person-plus me-1"></i>Employee Schedule
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-edit" data-bs-toggle="pill" data-bs-target="#pane-edit" type="button" role="tab">
        <i class="bi bi-pencil-square"></i>Overview of hours worked
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-delete" data-bs-toggle="pill" data-bs-target="#pane-delete" type="button" role="tab">
        <i class="bi bi-trash"></i>Select user
      </button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content" id="adminTabsContent">

    <!-- Manage Users Tab -->
    <div class="tab-pane fade show active" id="pane-manage" role="tabpanel" aria-labelledby="tab-manage">
      <div class="card shadow-sm p-4">
        <table class="table table-striped mb-0">
          <thead>
            <tr>
              <th>Name</th><th>Lastname</th><th>Email</th><th>Hours</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
              <tr>
                <td>{{ u.name }}</td>
                <td>{{ u.lastname }}</td>
                <td>{{ u.email }}</td>
                <td>TEST</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Delete User Tab -->
    <div class="tab-pane fade" id="pane-delete" role="tabpanel" aria-labelledby="tab-delete">
      <div class="card shadow-sm p-4 mb-4">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Select a user:</label>
            <select id="userSelectDelete" class="form-select">
              <option value="">- Select User -</option>
              {% for u in users %}
                <option value="{{ u.id }}">{{ u.name }} {{ u.lastname }}</option>
              {% endfor %}
            </select>
            <button id="btnDelete" type="submit" class="btn btn-danger mt-2" disabled>
              Select User
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Overview Tab -->
    <div class="tab-pane fade" id="pane-edit" role="tabpanel" aria-labelledby="tab-edit">
      <div class="card shadow-sm p-4 mb-4">
        <div class="row mb-3">
          <div class="col-md-4">
            <label for="dateFrom" class="form-label">From:</label>
            <input type="date" id="dateFrom" class="form-control">
          </div>
          <div class="col-md-4">
            <label for="dateTo" class="form-label">To:</label>
            <input type="date" id="dateTo" class="form-control">
          </div>
          <div class="col-md-4 d-flex align-items-end">
            <button id="searchRange" class="btn btn-primary w-100">Search Range</button>
          </div>
        </div>
        <div id="rangeResult" class="mb-2 fw-bold"></div>
        <ul id="workList" class="list-group"></ul>
      </div>
    </div>

    <!-- Empty Schedule Tab (for future use) -->
    <div class="tab-pane fade" id="pane-create" role="tabpanel" aria-labelledby="tab-create">
      <div class="card shadow-sm p-4">Schedule content goes here.</div>
    </div>

  </div>
</div>

<!-- JS Section -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Enable delete button if user is selected
    const userSelect = document.getElementById('userSelectDelete');
    const btnDelete = document.getElementById('btnDelete');
    if (userSelect) {
      userSelect.addEventListener('change', () => {
        btnDelete.disabled = userSelect.value === "";
      });
    }

    // Simulated data
    const workData = [
      { date: '2025-05-18', hours: 8 },
      { date: '2025-05-19', hours: 7 },
      { date: '2025-05-20', hours: 6 },
      { date: '2025-05-21', hours: 8 },
      { date: '2025-05-22', hours: 5 }
    ];

    const searchBtn = document.getElementById('searchRange');
    if (searchBtn) {
      searchBtn.addEventListener('click', () => {
        const from = document.getElementById('dateFrom').value;
        const to = document.getElementById('dateTo').value;
        const result = document.getElementById('rangeResult');
        const list = document.getElementById('workList');
        list.innerHTML = '';

        if (from && to) {
          const filtered = workData.filter(entry => entry.date >= from && entry.date <= to);
          if (filtered.length > 0) {
            result.textContent = `Hours worked from ${from} to ${to}:`;
            filtered.forEach(entry => {
              const li = document.createElement('li');
              li.className = 'list-group-item';
              li.textContent = `${entry.date}: ${entry.hours} hours`;
              list.appendChild(li);
            });
          } else {
            result.textContent = 'No work records found for this range.';
          }
        } else {
          result.textContent = 'Please select both dates.';
        }
      });
    }
  });
</script>

{% endblock %}
