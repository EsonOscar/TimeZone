{% extends "base.html" %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col">
      <h1 class="h3 mb-1">Organisation Administrator Control Panel</h1>
      <p class="text-muted">Welcome, {{ current_user.name }}!</p>
    </div>
    <div class="col">
      {# Flash messages #}
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, msg in messages %}
          <div class= "mt-1 alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endwith %}
    </div>
  </div>

  <!-- Nav pills -->
  <ul class="nav nav-pills mb-4" id="adminTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="tab-manage"
        data-bs-toggle="pill"
        data-bs-target="#pane-manage"
        type="button"
        role="tab"
      >
        <i class="bi bi-people me-1"></i>
        Employee List
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="tab-create"
        data-bs-toggle="pill"
        data-bs-target="#pane-create"
        type="button"
        role="tab"
      >
        <i class="bi bi-person-plus me-1"></i>
        Create Employee Account
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="tab-edit"
        data-bs-toggle="pill"
        data-bs-target="#pane-edit"
        type="button"
        role="tab"
      >
        <i class="bi bi-pencil-square"></i>
        Edit Employee
      </button>
    </li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content" id="adminTabsContent">
    <!-- Manage Users Pane -->
    <div
      class="tab-pane fade show active"
      id="pane-manage"
      role="tabpanel"
      aria-labelledby="tab-manage"
    >
      <div class="card shadow-sm p-4">
        <table class="table table-striped mb-0">
          <thead>
            <tr>
              <th>Name</th><th>Lastname</th><th>Email</th><th>Registered</th><th>Actions (Soonâ„¢)</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
            <tr>
              <td>{{ u.name }}</td>
              <td>{{ u.lastname }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.created_at }}</td>
              <td>
                <a href=""
                   class="btn btn-sm btn-outline-secondary disabled">
                   Edit
                </a>
                <a href=""
                   class="btn btn-sm btn-outline-danger disabled">
                   Delete
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Create User Pane -->
    <div
      class="tab-pane fade"
      id="pane-create"
      role="tabpanel"
      aria-labelledby="tab-create"
    >
      <div class="card shadow-sm p-4 mb-4">
        <form id="createForm" method="POST" action="{{ url_for('admin_create_user') }}">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">First Name</label>
              <input name="name" class="form-control" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">Last Name</label>
                <input name="lastname" class="form-control" required>
              </div>
            <div class="col-md-4">
              <label class="form-label">Email</label>
              <input name="email" type="email" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Username</label>
              <input name="username" class="form-control" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">Initial Password</label>
                <input name="password" type="password" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Role</label>
              <select name="role" class="form-select">
                <option value="employee">Employee</option>
              </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Pay type</label>
                <select name="paytype" class="form-select">
                  <option value="salary">Salary</option>
                  <option value="hourly">Hourly rate</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Ammount in DKK</label>
                <input name="pay" class="form-control" required>
            </div>
          </div>
          <button type="submit" class="btn btn-primary mt-4">
            Create User
          </button>
        </form>
      </div>
    </div>

    <!-- Edit User Pane -->
    <div
      class="tab-pane fade"
      id="pane-edit"
      role="tabpanel"
      aria-labelledby="tab-edit"
    >
      <div class="card shadow-sm p-4 mb-4">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Select which user to edit</label>
            <select name="user" class="form-select">
              <option value="">- Select User -</option>
              {% for u in users %}
                <option value="{{ u.id }}">
                  {{ u.name }} {{ u.lastname }}
                </option>
              {% endfor %}  
            </select>
          </div>
        </div>
      </div>
      <div class="card shadow-sm p-4 mb-4">
        <form method="POST" action="">
          <div class="row g-3">         
            <div class="col-md-4">
              <label class="form-label">First Name</label>
              <input name="name" class="form-control" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">Last Name</label>
                <input name="lastname" class="form-control" required>
              </div>
            <div class="col-md-4">
              <label class="form-label">Email</label>
              <input name="email" type="email" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Username</label>
              <input name="username" class="form-control" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">Initial Password</label>
                <input name="password" type="password" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Role</label>
              <select name="role" class="form-select">
                <option value="employee">Employee</option>
              </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Pay type</label>
                <select name="pay_type" class="form-select">
                  <option value="salary">Salary</option>
                  <option value="hourly">Hourly rate</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Ammount in DKK</label>
                <input name="pay" class="form-control" required>
            </div>
          </div>
          <button type="submit" class="btn btn-primary mt-4">
            Submit Changes
          </button>
        </form>
      </div>
    </div>
    
  </div>
</div>
{% endblock %}
